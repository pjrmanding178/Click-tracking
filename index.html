<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Location Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.2/dist/leaflet-routing-machine.js"></script>
    <style>
        #map {
            height: 400px;
            width: 100%;
            border-radius: 20px;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col items-center justify-start p-4 relative">
    <div class="mobile-tablet-only w-full max-w-lg mx-auto">
        <div id="map" class="mb-6"></div>

        <div class="mt-8">
            <button id="toggle-tracking" class="w-full bg-red-600 text-white text-lg font-semibold py-3 rounded-lg">
                Start Sharing Location
            </button>
        </div>
    </div>

    <script>
        let map = L.map('map').setView([16.153958483283986, 119.97947908028726], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        let marker = L.marker([16.153958483283986, 119.97947908028726]).addTo(map);
        let routingControl = L.Routing.control({
            waypoints: [L.latLng(16.153958483283986, 119.97947908028726), L.latLng(16.155, 119.985)], // Add a dummy destination
            routeWhileDragging: true,
            createMarker: function() { return null; }
        }).addTo(map);

        let isTracking = false;
        let watchID;

        document.getElementById('toggle-tracking').addEventListener('click', function () {
            if (!isTracking) {
                if (navigator.geolocation) {
                    watchID = navigator.geolocation.watchPosition(function (position) {
                        const newLat = position.coords.latitude;
                        const newLng = position.coords.longitude;
                        const newLatLng = L.latLng(newLat, newLng);

                        // Update the marker and map view
                        marker.setLatLng(newLatLng);
                        map.setView(newLatLng, map.getZoom());

                        // Update the starting point of the route dynamically
                        let currentWaypoints = routingControl.getWaypoints();
                        routingControl.setWaypoints([newLatLng, currentWaypoints[1].latLng]);

                    }, function (error) {
                        alert("Error: " + error.message);
                    }, {
                        enableHighAccuracy: true,
                        maximumAge: 1000
                    });

                    this.innerHTML = 'Stop Sharing Location';
                } else {
                    alert('Geolocation is not supported by your browser.');
                }
                isTracking = true;
            } else {
                navigator.geolocation.clearWatch(watchID);
                this.innerHTML = 'Start Sharing Location';
                isTracking = false;
            }
        });

        routingControl.on('routesfound', function(e) {
            const route = e.routes[0];
            const travelTime = Math.round(route.summary.totalTime / 60); // Convert seconds to minutes
            const distance = (route.summary.totalDistance / 1000).toFixed(2); // Convert meters to kilometers
            console.log(`Travel Time: ${travelTime} minutes`);
            console.log(`Distance: ${distance} km`);
        });
    </script>
</body>
</html>